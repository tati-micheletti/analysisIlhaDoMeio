---
title: "Wildlife Ilha do Meio and Rata"
author: "Tati Micheletti"
date: "10/19/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Libraries and source functions

The first step is to load the libraries we need and source the functions that will prepare the data 
and run the models for each one of the species analyzed.

```{r libs}
if(!require("Require")){
    install.packages("Require")
}
library("Require")
Require("googledrive")
Require("reproducible")
Require("data.table")
Require("unmarked")
Require("tictoc")
Require("qs")
# If any packages were installed here, restart your session and re-run the code!
# Here we list all functions and then source all of them:
allFls <- list.files(path = "./functions", full.names = TRUE)
for (fl in allFls){
  message(paste0("Sourcing the function ", basename(fl))) 
  source(file = fl) 
}
```

## Endangered species

Then we load the data and format the information we need for the models. The `IPA.csv` file contains 
all data for the endangered species. Sea birds' data are hosted in another file, loaded below.

```{r loadAndCheckData}
Data <- loadESData(dataLocation = "data/IPA.csv")
```

## Mabuia  

We will start our analysis with the Mabuia (Noronha Skink; *Trachylepis atlantica*).   

First we will run the models for the Ilha do Meio. For the mabuia, Negative 
Binomial Models would have been appropriate, as these model counts, especially if there is variability in the underlying rate of events. However, these are better suited for overdispersed data, which ours 
isn't. Mabuia data is, however, Zero inflated. So ZIP models are more appropriate to use (see Kery, 
2018 and Stoklosa et al. 2022). Moreover, the mabuia population is closed to immigration, considering 
the island is not close enough to others to allow for the species to immigrate. As the predation rate 
by rats is high, we consider every sampling occasion as primary (i.e., open population) and add a 
covariate for the time since the start of the eradication.

```{r mabuiaMeio}
mabuiaMeio <- modelMabuia(DT = Data, island = "Ilha do Meio")
```

Now we will run the models for Mabuia for Ilha Rata (our control). 

```{r mabuiaRata}
mabuiaRata <- modelMabuia(DT = Data, island = "Ilha Rata")
```

## Elenia  

Next, we will continue our analysis with the Noronha Elaenia (; *Trachylepis atlantica*). 

```{r elaeniaRata}
elaeniaMeio <- modelElaenia(DT = Data, island = "Ilha do Meio", rerunModels = TRUE)
elaeniaRata <- modelElaenia(DT = Data, island = "Ilha Rata", rerunModels = TRUE)
mabuiaRata <- modelMabuia(DT = Data, island = "Ilha Rata")
```

First we will run the models for the Ilha do Meio. For the mabuia, Negative 
